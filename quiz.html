<!-- mesmo <head> e <style> do exemplo anterior -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getAuth,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import {
    getFirestore,
    doc,
    getDoc,
    updateDoc,
    setDoc
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBhSmocbaARqU_pPM0Tqki8d11jm97IE4M",
    authDomain: "dashboardfeqzin.firebaseapp.com",
    projectId: "dashboardfeqzin",
    storageBucket: "dashboardfeqzin.firebasestorage.app",
    messagingSenderId: "1042985498691",
    appId: "1:1042985498691:web:16ab98f93f925ebf7b7cf6",
    measurementId: "G-QZY8SDZX5T"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  let currentUser = null;
  let quizRespondido = false;
  let pontos = 0;

  const perguntas = [
    {
      pergunta: "Qual ano Feqzin começou a produzir músicas?",
      opcoes: ["2015", "2017", "2020", "2022"],
      resposta: "2022"
    },
    {
      pergunta: "Qual bairro o artista Feqzin é?",
      opcoes: ["Vila Maria", "Brasilândia", "Jardim Brasil", "Jaçanã"],
      resposta: "Jardim Brasil"
    },
    {
      pergunta: "Qual é o estilo musical do Feqzin?",
      opcoes: ["Funk", "Sertanejo", "Trap", "Pagode"],
      resposta: "Trap"
    },
    {
      pergunta: "Qual é o nome artístico do Fernando?",
      opcoes: ["MC Fe", "Feqzin", "FZ7", "ZinFe"],
      resposta: "Feqzin"
    },
    {
      pergunta: "Qual ferramenta Feqzin usou para produzir a primeira faixa?",
      opcoes: ["Notebook", "Estúdio", "Celular", "Mesa de som"],
      resposta: "Celular"
    },
    {
      pergunta: "Feqzin é conhecido por qual característica vocal?",
      opcoes: ["Timbre rouco", "Autenticidade", "Auto-Tune", "Graves potentes"],
      resposta: "Autenticidade"
    },
    {
      pergunta: "Qual é a principal estética do Feqzin?",
      opcoes: ["Lo-fi", "Brega Funk", "Underground", "Sertanejo universitário"],
      resposta: "Underground"
    },
    {
      pergunta: "Quando Feqzin iniciou sua trajetória oficialmente?",
      opcoes: ["2019", "2020", "2021", "2022"],
      resposta: "2022"
    },
    {
      pergunta: "Que tipo de som Feqzin lança?",
      opcoes: ["MPB", "Trap", "Indie Rock", "Funk Melody"],
      resposta: "Trap"
    },
    {
      pergunta: "Em que cidade fica o bairro Jardim Brasil?",
      opcoes: ["Campinas", "São Paulo", "Guarulhos", "Santos"],
      resposta: "São Paulo"
    }
  ];

  function renderPergunta(index) {
    const q = perguntas[index];
    const quizArea = document.getElementById("quiz-area");
    quizArea.innerHTML = `
      <div class="question"><strong>${q.pergunta}</strong></div>
      <div class="options">
        ${q.opcoes.map((op) => `
          <div class="option">
            <input type="radio" name="resposta" value="${op}" id="${op}" />
            <label for="${op}">${op}</label>
          </div>
        `).join("")}
      </div>
      <button onclick="verificarResposta(${index})">Confirmar</button>
    `;
  }

  window.startQuiz = () => {
    if (quizRespondido && currentUser?.email !== "fernandoq87@gmail.com") {
      alert("Você já respondeu esse quiz!");
      return;
    }
    pontos = 0;
    renderPergunta(0);
  };

  window.verificarResposta = async (index) => {
    const selecionada = document.querySelector('input[name="resposta"]:checked');
    if (!selecionada) return alert("Escolha uma opção!");
    const correta = perguntas[index].resposta;
    if (selecionada.value === correta) {
      pontos += 10;
    }

    if (index + 1 < perguntas.length) {
      renderPergunta(index + 1);
    } else {
      document.getElementById("quiz-area").innerHTML = `<h3>Quiz Finalizado!</h3><p>Você fez ${pontos} pontos.</p>`;
      if (currentUser) {
        const userDoc = doc(db, "usuarios", currentUser.uid);
        const snapshot = await getDoc(userDoc);
        const dados = snapshot.exists() ? snapshot.data() : { pontos: 0, quizRespondido: false };
        await updateDoc(userDoc, {
          pontos: dados.pontos + pontos,
          quizRespondido: currentUser.email === "fernandoq87@gmail.com" ? false : true
        });
        carregarPontos(currentUser);
      }
    }
  };

  async function carregarPontos(user) {
    if (!user) {
      document.getElementById("pontos").innerText = "Pontos: (faça login para resgatar)";
      return;
    }
    const userDoc = doc(db, "usuarios", user.uid);
    const snapshot = await getDoc(userDoc);
    if (snapshot.exists()) {
      const dados = snapshot.data();
      quizRespondido = dados.quizRespondido || false;
      document.getElementById("pontos").innerText = `Pontos: ${dados.pontos || 0}`;
    } else {
      await setDoc(userDoc, { pontos: 0, quizRespondido: false });
      document.getElementById("pontos").innerText = `Pontos: 0`;
    }
  }

  window.resgatarItem = async () => {
    if (!currentUser) return alert("Você precisa estar logado para resgatar prêmios.");
    const userDoc = doc(db, "usuarios", currentUser.uid);
    const snapshot = await getDoc(userDoc);
    if (snapshot.exists()) {
      const dados = snapshot.data();
      if (dados.pontos >= 50) {
        await updateDoc(userDoc, { pontos: dados.pontos - 50 });
        alert("Item resgatado com sucesso!");
        carregarPontos(currentUser);
      } else {
        alert("Pontos insuficientes.");
      }
    }
  };

  onAuthStateChanged(auth, (user) => {
    currentUser = user;
    carregarPontos(user);
  });
</script>
