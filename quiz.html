<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz Feqzin | Ganhe Pontos e Resgate Prêmios</title>
  <style>
    body {
      background: #0e0e0e;
      color: #f1f1f1;
      font-family: Arial, sans-serif;
      margin: 0; padding: 0 20px 40px;
      max-width: 700px; margin-left: auto; margin-right: auto;
    }
    h1, h2 {
      color: #1db954;
      text-align: center;
    }
    #auth-section, #quiz-section, #resgate-section, #resultado-section {
      background: #111;
      border: 2px solid #1db954;
      border-radius: 12px;
      padding: 20px;
      margin-top: 30px;
    }
    #auth-message {
      margin-top: 10px;
      min-height: 1.2em;
      font-weight: bold;
      text-align: center;
    }
    input[type="email"], input[type="password"] {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 6px;
      border: 1px solid #444;
      background: #222;
      color: #f1f1f1;
      font-size: 1em;
    }
    button {
      background: #1db954;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 12px 20px;
      font-weight: bold;
      font-size: 1em;
      cursor: pointer;
      margin-top: 10px;
      width: 100%;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #1ed760;
    }
    #btnLogout {
      background: #f44336;
      margin-top: 15px;
      display: none;
      width: auto;
      padding: 10px 15px;
    }
    .hidden { display: none; }
    .question {
      margin-top: 20px;
    }
    .answers button {
      width: 100%;
      margin: 6px 0;
      background: #222;
      color: #f1f1f1;
      border: 1px solid #444;
      border-radius: 6px;
      padding: 10px;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .answers button:hover {
      background: #333;
    }
    #pontuacao {
      font-size: 1.2em;
      margin-top: 10px;
      text-align: center;
      color: #1db954;
    }
    #resgate-list {
      margin-top: 15px;
    }
    #resgate-list button {
      margin: 5px 0;
      background: #1db954;
      width: 100%;
      font-weight: bold;
      border-radius: 6px;
    }
    #resgate-list button:disabled {
      background: #555;
      cursor: not-allowed;
    }
    #start-quiz {
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h1>Quiz Feqzin</h1>

  <!-- Autenticação -->
  <section id="auth-section">
    <h2>Login / Cadastro</h2>
    <form id="auth-form">
      <input type="email" id="email" placeholder="Seu email" required autocomplete="username" />
      <input type="password" id="password" placeholder="Sua senha" required autocomplete="current-password" />
      <button type="submit" id="btn-login">Entrar</button>
      <button type="button" id="btn-signup">Cadastrar</button>
      <button type="button" id="btn-reset-password">Esqueci a senha</button>
      <button type="button" id="btnLogout">Logout</button>
    </form>
    <div id="auth-message"></div>
  </section>

  <!-- Exibição da pontuação e resgate -->
  <section id="resgate-section" class="hidden">
    <h2>Resgate Seus Prêmios</h2>
    <div id="pontuacao">Sua pontuação: 0 pontos</div>
    <div id="resgate-list">
      <!-- Itens de resgate serão inseridos aqui -->
    </div>
  </section>

  <!-- Quiz -->
  <section id="quiz-section" class="hidden">
    <h2>Quiz</h2>
    <div id="question-container"></div>
    <button id="next-btn" class="hidden">Próxima</button>
  </section>

  <!-- Resultado -->
  <section id="resultado-section" class="hidden">
    <h2>Parabéns! Você terminou o quiz.</h2>
    <div id="resultado-pontuacao"></div>
    <button id="restart-btn">Fazer quiz novamente</button>
  </section>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // Config Firebase (use suas chaves)
    const firebaseConfig = {
      apiKey: "AIzaSyBhSmocbaARqU_pPM0Tqki8d11jm97IE4M",
      authDomain: "dashboardfeqzin.firebaseapp.com",
      projectId: "dashboardfeqzin",
      storageBucket: "dashboardfeqzin.firebasestorage.app",
      messagingSenderId: "1042985498691",
      appId: "1:1042985498691:web:16ab98f93f925ebf7b7cf6",
      measurementId: "G-QZY8SDZX5T"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Elementos DOM
    const authForm = document.getElementById("auth-form");
    const emailInput = document.getElementById("email");
    const passwordInput = document.getElementById("password");
    const btnLogin = document.getElementById("btn-login");
    const btnSignup = document.getElementById("btn-signup");
    const btnResetPassword = document.getElementById("btn-reset-password");
    const btnLogout = document.getElementById("btnLogout");
    const authMessage = document.getElementById("auth-message");

    const resgateSection = document.getElementById("resgate-section");
    const pontuacaoDisplay = document.getElementById("pontuacao");
    const resgateList = document.getElementById("resgate-list");

    const quizSection = document.getElementById("quiz-section");
    const questionContainer = document.getElementById("question-container");
    const nextBtn = document.getElementById("next-btn");

    const resultadoSection = document.getElementById("resultado-section");
    const resultadoPontuacao = document.getElementById("resultado-pontuacao");
    const restartBtn = document.getElementById("restart-btn");

    let currentUser = null;
    let currentUID = null;
    let pontosUsuario = 0;

    // Perguntas do quiz
    const perguntas = [
      {
        pergunta: "Qual é a capital do Brasil?",
        respostas: [
          { texto: "São Paulo", correta: false },
          { texto: "Brasília", correta: true },
          { texto: "Rio de Janeiro", correta: false },
          { texto: "Salvador", correta: false }
        ]
      },
      {
        pergunta: "Quem é o artista Feqzin?",
        respostas: [
          { texto: "Um chef famoso", correta: false },
          { texto: "Um cantor e produtor da zona norte de SP", correta: true },
          { texto: "Um jogador de futebol", correta: false },
          { texto: "Um influenciador digital de moda", correta: false }
        ]
      },
      {
        pergunta: "Qual destas linguagens é usada para estilizar páginas web?",
        respostas: [
          { texto: "HTML", correta: false },
          { texto: "CSS", correta: true },
          { texto: "Python", correta: false },
          { texto: "SQL", correta: false }
        ]
      },
      {
        pergunta: "Qual é a moeda oficial do Brasil?",
        respostas: [
          { texto: "Real", correta: true },
          { texto: "Dólar", correta: false },
          { texto: "Euro", correta: false },
          { texto: "Peso", correta: false }
        ]
      },
      {
        pergunta: "Qual destas é uma plataforma para hospedagem de código?",
        respostas: [
          { texto: "GitHub", correta: true },
          { texto: "YouTube", correta: false },
          { texto: "Spotify", correta: false },
          { texto: "Instagram", correta: false }
        ]
      }
    ];

    // Itens para resgate, com custo em pontos
    const itensResgate = [
      { id: "camiseta", nome: "Camiseta Oficial Feqzin", custo: 50 },
      { id: "adesivo", nome: "Adesivo Exclusivo", custo: 20 },
      { id: "download", nome: "Download VIP da música", custo: 100 }
    ];

    let currentQuestionIndex = 0;
    let pontosGanhosNoQuiz = 0;

    // Função para atualizar a pontuação do usuário no Firestore e na tela
    async function atualizarPontuacao(novaPontuacao) {
      pontosUsuario = novaPontuacao;
      pontuacaoDisplay.textContent = `Sua pontuação: ${pontosUsuario} pontos`;

      if (!currentUID) return;
      try {
        await db.collection("usuarios").doc(currentUID).set(
          { pontos: pontosUsuario },
          { merge: true }
        );
      } catch (e) {
        console.error("Erro ao atualizar pontuação:", e);
      }
    }

    // Carregar pontuação do usuário
    async function carregarPontuacao() {
      if (!currentUID) return;
      try {
        const doc = await db.collection("usuarios").doc(currentUID).get();
        if (doc.exists) {
          pontosUsuario = doc.data().pontos || 0;
        } else {
          pontosUsuario = 0;
        }
        pontuacaoDisplay.textContent = `Sua pontuação: ${pontosUsuario} pontos`;
      } catch (e) {
        console.error("Erro ao carregar pontuação:", e);
      }
    }

    // Mostrar itens de resgate habilitados/desabilitados conforme pontuação
    function mostrarItensResgate() {
      resgateList.innerHTML = "";
      itensResgate.forEach(item => {
        const btn = document.createElement("button");
        btn.textContent = `${item.nome} - ${item.custo} pontos`;
        btn.disabled = pontosUsuario < item.custo;
        btn.addEventListener("click", () => {
          if (pontosUsuario >= item.custo) {
            if (confirm(`Deseja trocar ${item.custo} pontos por ${item.nome}?`)) {
              pontosUsuario -= item.custo;
              atualizarPontuacao(pontosUsuario);
              alert(`Parabéns! Você resgatou: ${item.nome}`);
              mostrarItensResgate();
            }
          }
        });
        resgateList.appendChild(btn);
      });
    }

    // Renderizar pergunta atual
    function mostrarPergunta() {
      clearStatusClass();
      nextBtn.classList.add("hidden");
      const perguntaAtual = perguntas[currentQuestionIndex];
      questionContainer.innerHTML = `<div class="question"><strong>${perguntaAtual.pergunta}</strong></div>`;
      const divRespostas = document.createElement("div");
      divRespostas.classList.add("answers");

      perguntaAtual.respostas.forEach(resposta => {
        const btn = document.createElement("button");
        btn.textContent = resposta.texto;
        btn.addEventListener("click", () => selecionarResposta(btn, resposta.correta));
        divRespostas.appendChild(btn);
      });
      questionContainer.appendChild(divRespostas);
    }

    // Limpa classes de status nos botões
    function clearStatusClass() {
      Array.from(questionContainer.querySelectorAll("button")).forEach(button => {
        button.style.backgroundColor = "#222";
        button.disabled = false;
      });
    }

    // Tratamento da resposta selecionada
    function selecionarResposta(button, correta) {
      const buttons = questionContainer.querySelectorAll("button");
      buttons.forEach(b => b.disabled = true);

      if (correta) {
        button.style.backgroundColor = "#1db954";
        pontosGanhosNoQuiz++;
      } else {
        button.style.backgroundColor = "#f44336";
      }

      nextBtn.classList.remove("hidden");
    }

    // Evento do botão próxima pergunta
    nextBtn.addEventListener("click", () => {
      currentQuestionIndex++;
      if (currentQuestionIndex < perguntas.length) {
        mostrarPergunta();
      } else {
        finalizarQuiz();
      }
    });

    // Finalizar quiz e mostrar resultado
    async function finalizarQuiz() {
      quizSection.classList.add("hidden");
      resultadoSection.classList.remove("hidden");
      resultadoPontuacao.textContent = `Você acertou ${pontosGanhosNoQuiz} de ${perguntas.length} perguntas!`;

      // Atualizar pontuação do usuário somando o que ganhou no quiz
      await atualizarPontuacao(pontosUsuario + pontosGanhosNoQuiz);
      mostrarItensResgate();
      resgateSection.classList.remove("hidden");
    }

    // Reiniciar quiz
    restartBtn.addEventListener("click", () => {
      resultadoSection.classList.add("hidden");
      currentQuestionIndex = 0;
      pontosGanhosNoQuiz = 0;
      mostrarPergunta();
      quizSection.classList.remove("hidden");
    });

    // Controle de autenticação e UI
    auth.onAuthStateChanged(async user => {
      if (user) {
        currentUser = user;
        currentUID = user.uid;
        authMessage.style.color = "lightgreen";
        authMessage.textContent = `Logado como: ${user.email}`;

        // Esconde form login e mostra logout e quiz
        emailInput.style.display = "none";
        passwordInput.style.display = "none";
        btnLogin.style.display = "none";
        btnSignup.style.display = "none";
        btnResetPassword.style.display = "none";
        btnLogout.style.display = "inline-block";

        await carregarPontuacao();
        mostrarItensResgate();

        resgateSection.classList.remove("hidden");
        quizSection.classList.remove("hidden");
        authSection.style.display = "block";
      } else {
        currentUser = null;
        currentUID = null;
        pontosUsuario = 0;
        pontosGanhosNoQuiz = 0;

        authMessage.textContent = "";
        emailInput.style.display = "block";
        passwordInput.style.display = "block";
        btnLogin.style.display = "inline-block";
        btnSignup.style.display = "inline-block";
        btnResetPassword.style.display = "inline-block";
        btnLogout.style.display = "none";

        resgateSection.classList.add("hidden");
        quizSection.classList.add("hidden");
        resultadoSection.classList.add("hidden");
        authSection.style.display = "block";

        pontuacaoDisplay.textContent = "";
        questionContainer.innerHTML = "";
      }
    });

    // Login
    authForm.addEventListener("submit", e => {
      e.preventDefault();
      auth.signInWithEmailAndPassword(emailInput.value, passwordInput.value)
        .catch(err => {
          authMessage.style.color = "tomato";
          authMessage.textContent = `Erro no login: ${err.message}`;
        });
      authForm.reset();
    });

    // Cadastro
    btnSignup.addEventListener("click", () => {
      if (!emailInput.value || !passwordInput.value) {
        authMessage.style.color = "tomato";
        authMessage.textContent = "Preencha email e senha para cadastrar.";
        return;
      }
      auth.createUserWithEmailAndPassword(emailInput.value, passwordInput.value)
        .then(() => {
          authMessage.style.color = "lightgreen";
          authMessage.textContent = "Usuário criado! Faça login.";
          authForm.reset();
        })
        .catch(err => {
          authMessage.style.color = "tomato";
          authMessage.textContent = `Erro no cadastro: ${err.message}`;
        });
    });

    // Reset senha
    btnResetPassword.addEventListener("click", () => {
      if (!emailInput.value) {
        authMessage.style.color = "tomato";
        authMessage.textContent = "Digite seu e-mail para redefinir a senha.";
        return;
      }
      auth.sendPasswordResetEmail(emailInput.value)
        .then(() => {
          authMessage.style.color = "lightgreen";
          authMessage.textContent = "E-mail de redefinição enviado.";
        })
        .catch(err => {
          authMessage.style.color = "tomato";
          authMessage.textContent = `Erro: ${err.message}`;
        });
    });

    // Logout
    btnLogout.addEventListener("click", () => auth.signOut());

    // Mostrar primeira pergunta ao clicar no quiz (quando logado)
    quizSection.classList.add("hidden");
    nextBtn.classList.add("hidden");
  </script>
</body>
</html>
